/* Copyright (c) 2014 Michael Eisenbraun (http://jquery.michaeleisenbraun.com)
 * Licensed under the MIT License.
 *
 * Version: 1.0.0
 *
 * Requires: jQuery 1.7.2+
 *//**** 
TO DO LIST: 

Allow for callback function, when field is invalid.

***/if(!window.console)var console={log:function(){}};(function(e){e.fn.guardian=function(n){return this.each(function(){var r=e(this),i=r.data("guardian");i||r.data("guardian",i=new t(this,n));return i}).data("guardian")};var t=function(t,n){this.$el=e(t);n&&e.extend(this,n);return this.init()};t.prototype={$patterns:{alpha:/^[a-z_'&]+$/i,alnum:/^[\w'&]+$/,number:/^(-?)((\d+)|(\d+).(\d*))$/,currency:/^(-)?(\$)?(\d+)+(,?\d{3})*(\.\d{2})?$/,zip:/(^\d{5,9}$)|(^\d{5}-\d{4}$)/,year:/(^(19|20)\d{2})$/,phone:/^\(?(\d{3})\)?[-. ]?(\d{3})[-. ]?(\d{4})$/,email:/^[\w&]([\w\-\.'&]*)@([\w\-\.]*)(\.[a-z]{2,6}(\.[a-z]{2}){0,2})$/i,url:/^(([http|https]+):)(\/{2})([0-9.\-A-Za-z]+)\.([0-9.\-A-Za-z]+)\.([0-9.\-A-Za-z]+)(?::(\d+))?(?:\/([^?#]*))?(?:\?([^#]*))?(?:#(.*))?$/,date:/^(Jan|January|Feb|February|Mar|March|Apr|April|May|Jun|June|Jul|July|Aug|August|Sep|September|Oct|October|Nov|November|Dec|December|(0?\d{1})|(10|11|12))(-|\s|\/|\.)(0?[1-9]|(1|2)[0-9]|3(0|1))(-|\s|\/|\.|,\s)(19|20)?\d\d$/i},$status:{changed:!1,submitted:!1},$inputs:null,$groups:null,$textInputs:["text","password","currency"],$matchInputs:["match"],$hiddenInputs:["hidden","submit","button"],$phoneInputs:["tel","phone"],$numberInputs:["number","num"],$emailInputs:["email"],$fileInputs:["file"],$radioInputs:["radio"],$checkboxInputs:["checkbox"],$customInputs:null,init:function(){var t=this,n=this.$el;t.$inputs={};t.$groups={};t.customInputs=[];var r=e("*[data-group-name]",n),i=r.length;for(var s=0;s<i;s++)this.addGroup(r.eq(s));n.attr("novalidate","novalidate");n.on("blur",":input",this,t.onBlur);var o=e("[data-counter]",n);o.each(function(){var t=e(this),r=t.attr("name"),i=n.attr("id");if(t.attr("maxlength")){var s=t.val(),o=parseInt(t.attr("maxlength"),10),u=o-s.length,a=t.width();t.addClass("ui-counter");t.after('<div class="ui-counters" style="width:'+a+'px"><span id="counter-'+i+"-"+r+'">'+u+"</span> Characters left</div>")}else t.removeAttr("data-counter")});n.on("keyup",":input[data-counter]",function(){var t=e(this),r=t.val(),i=n.attr("id"),s=t.attr("name"),o=parseInt(t.attr("maxlength"),10),u=o-r.length;e("#counter-"+i+"-"+s).html(u)});n.on("submit",function(n){var r=e(this),i=r.find(":input"),s=i.length;t.$event=n;t.$status.submitted=!0;t.before&&t.before();if(!t.validateAll()){t.$status.submitted=!1;t.failure&&t.failure();return!1}return t.success?t.success():!0});t.extend&&t.extend();return t},addGroup:function(t){var n=t.data("group-name");t.addClass("group");this.$groups[n]={min:t.data("group-min")?t.data("group-min"):0,max:t.data("group-max")?t.data("group-max"):Infinity,count:0,members:t.data("group-members")?t.data("group-members").split(" "):null};if(this.$groups[n].members){var r=this.$groups[n].members.length;for(var i=0;i<r;i++)e('*[name="'+this.$groups[n].members[i]+'"]').attr("data-group",n)}},addInputTypes:function(t){var n=this;e.each(t,function(e,t){switch(e){case"text":n.$textInputs.push(t);break;case"match":n.$matchInputs.push(t);break;case"hidden":n.$hiddenInputs.push(t);break;case"phone":n.$phoneInputs.push(t);break;case"number":n.$numberInputs.push(t);break;case"email":n.$emailInputs.push(t);break;case"radio":n.$radioInputs.push(t);break;case"checkbox":n.$checkboxInputs.push(t);break;case"custom":n.$customInputs.push(t)}})},addPattern:function(t){t&&e.extend(this.$patterns,t)},createErrorMessage:function(t){var n=t.attr("name"),r=t.val(),i=this.$el.attr("id"),s=t.data("error-message"),o=t.data("empty-message");e("#error-message-"+i+"-"+n).length||(s||o)&&t.after('<span class="ui-error-message" id="error-message-'+i+"-"+n+'"></span>');!r.length&&o?e("#error-message-"+i+"-"+n).html(o):e("#error-message-"+i+"-"+n).html(s)},addCommas:function(e){var t=/(\d+)(\d{3})/;while(t.test(e))e=e.replace(t,"$1,$2");return e},formatPhone:function(e){return e.replace(this.$patterns.phone,"($1) $2-$3")},formatCurrency:function(e){var t=this;return e.replace(t.$patterns.currency,function(){arguments[3]=arguments[3].length>3?t.addCommas(arguments[3]):arguments[3];var e=arguments[3];arguments[2]?e=arguments[2]+arguments[3]:e="$"+arguments[3];arguments[1]&&(e=arguments[1]+e);arguments[4]&&(e+=arguments[4]);arguments[5]?e+=arguments[5]:e+=".00";return e})},getInvalid:function(){var e=[],t=this.$inputs.length;for(el in this.$inputs)this.$inputs[el]||e.push(el);return e},isIE:function(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent))return!0},isFF3:function(){if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){var e=new Number(RegExp.$1);if(e<=4)return!0}},onBlur:function(t){var n=t.data,r=e(this),i=r.attr("name"),s=r.parent();n.$event=t;n.validateElement(r);t.type==="change"&&(n.$status.changed=!0);s.removeClass(n.highlight)},onFocus:function(e){},validationHandler:function(t){var n=t[0].tagName,r=t[0].type,i=t.attr("name"),s={parent:t.parent()},o=t.data("group"),u=this.$groups[o],a=this.$el.attr("id");s.valid=this.$inputs[i];if(u){var f=u.members,l=f.length;s.parent=e("#"+o);if(r==="checkbox"){t.is(":checked")?u.count++:this.$event.type!=="submit"&&u.count>0&&u.count--;if(u.count<u.min||u.count>u.max){s.valid=!1;this.$inputs[o]=!1}else{s.valid=!0;this.$inputs[o]=!0}}else for(var c=0;c<l;c++)this.$inputs[f[c]]||(s.valid=!1)}if(e.inArray(r,this.$hiddenInputs)===-1)if(s.valid){s.parent.addClass(this.valid).removeClass(this.invalid);e("#error-message-"+a+"-"+i).hide()}else{s.parent.addClass(this.invalid).removeClass(this.valid);this.createErrorMessage(t);e("#error-message-"+a+"-"+i).fadeIn()}},validateAll:function(){var t=this,n=t.$el.find(":input");t.$event={type:null};e.each(t.$groups,function(e,t){t.count=0});e.each(n,function(){t.validateElement(e(this))});return t.getInvalid().length?!1:!0},validateCustom:function(e){console.log(e)},validateHidden:function(e){var t=e.attr("name");val=e.val();this.$inputs[t]=!0;return this.$inputs[t]},validatePhone:function(e){var t=e.attr("name"),n=e.val();this.$inputs[t]=!0;if(e.attr("required")||n.length)if(this.$patterns.phone.test(n)){this.$inputs[t]=!0;e.val(this.formatPhone(n))}else this.$inputs[t]=!1;this.validationHandler(e);return this.$inputs[t]},validateNumber:function(e){var t=e.attr("name"),n=parseFloat(e.val()),r=e.attr("min")?Number(e.attr("min")):-Infinity,i=e.attr("max")?Number(e.attr("max")):Infinity;this.$inputs[t]=!0;if(e.attr("required")||n.length){isNaN(n)===!0&&(this.$inputs[t]=!1);if(n<r||n>i)this.$inputs[t]=!1;typeof pattern!="undefined"&&(this.$patterns[pattern].test(n)||(this.$inputs[t]=!1))}this.$inputs[t]&&!isNaN(n)&&e.val(n);this.validationHandler(e);return this.$inputs[t]},validateEmail:function(e){var t=e.attr("name"),n=e.val();this.$inputs[t]=!0;if(e.attr("required")||n.length)this.$patterns.email.test(n)?this.$inputs[t]=!0:this.$inputs[t]=!1;this.validationHandler(e);return this.$inputs[t]},validateText:function(e){var t=e.attr("name"),n=e.val(),r=e.data("pattern");this.$inputs[t]=!0;if(e.attr("required")||n.length)typeof r!="undefined"?this.$patterns[r].test(n)||(this.$inputs[t]=!1):this.$patterns.alnum.test(n)||(this.$inputs[t]=!1);r=="currency"&&this.$inputs[t]&&e.val(this.formatCurrency(n));this.validationHandler(e);return this.$inputs[t]},validateFile:function(e){var t=e.attr("name"),n=e.val();this.$inputs[t]=!1;n&&(this.$inputs[t]=!0);this.validationHandler(e);return this.$inputs[t]},validateRadio:function(t){var n=t.attr("name");this.$inputs[n]=!0;if(t.attr("required")){this.$inputs[n]=!1;e('input[name="'+n+'"]').each(function(){e(this).is(":checked")&&(this.$inputs[n]=!0)})}this.validationHandler(t);return this.$inputs[n]},validateCheckbox:function(e){var t=e.attr("name");this.$inputs[t]=!0;e.attr("required")&&!e.is(":checked")&&(this.$inputs[t]=!1);this.validationHandler(e);return this.$inputs[t]},validateSelect:function(e){var t=e.attr("name");val=e.val();this.$inputs[t]=!0;e.attr("required")&&(val===""||!val)&&(this.$inputs[t]=!1);this.validationHandler(e);return this.$inputs[t]},validateTextarea:function(e){var t=e.attr("name"),n=e.val(),r=e.data("pattern");this.$inputs[t]=!0;if(e.attr("required")||n.length)typeof r!="undefined"?this.$patterns[r].test(n)||(this.$inputs[t]=!1):this.$patterns.alnum.test(n)||(this.$inputs[t]=!1);this.validationHandler(e);return this.$inputs[t]},validateMatch:function(t){var n=t.attr("name"),r=t.val(),i=e("#"+t.data("match-input"));this.$inputs[n]=!0;if(t.attr("required")||r.length){(i.data("pattern")=="phone"||i.attr("type")=="tel")&&t.val(this.formatPhone(r));r!=i.val()&&(this.$inputs[n]=!1)}this.validationHandler(t);return this.$inputs[n]},validateElement:function(t){var n=t[0].tagName,r=t[0].type,i=t.attr("name"),s=t.data("pattern");switch(n){case"INPUT":if(e.inArray(r,this.$customInputs)!=-1||e.inArray(s,this.$customInputs)!=-1)return this.validateCustom(t);if(e.inArray(r,this.$matchInputs)!=-1||e.inArray(s,this.$matchInputs)!=-1)return this.validateMatch(t);if(e.inArray(r,this.$hiddenInputs)!=-1||e.inArray(s,this.$hiddenInputs)!=-1)return this.validateHidden(t);if(e.inArray(r,this.$phoneInputs)!=-1||e.inArray(s,this.$phoneInputs)!=-1)return this.validatePhone(t);if(e.inArray(r,this.$numberInputs)!=-1||e.inArray(s,this.$numberInputs)!=-1)return this.validateNumber(t);if(e.inArray(r,this.$emailInputs)!=-1||e.inArray(s,this.$emailInputs)!=-1)return this.validateEmail(t);if(e.inArray(r,this.$textInputs)!=-1||e.inArray(s,this.$textInputs)!=-1)return this.validateText(t);if(e.inArray(r,this.$fileInputs)!=-1||e.inArray(s,this.$fileInputs)!=-1)return this.validateFile(t);if(e.inArray(r,this.$radioInputs)!=-1)return this.validateRadio(t);if(e.inArray(r,this.$checkboxInputs)!=-1)return this.validateCheckbox(t);break;case"BUTTON":return this.validateHidden(t);case"SELECT":return this.validateSelect(t);case"TEXTAREA":return this.validateTextarea(t);default:e.error("Element type or data pattern could not be found.");return!1}},valid:"ui-state-valid",invalid:"ui-state-invalid",highlight:"ui-state-highlight",before:null,success:null,failure:null,extend:null}})(jQuery);